<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <title>LCOV - go.info - /home/alberts/deps/src/code.google.com/p/goprotobuf/proto/lib.go</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../../index.html">top level</a> - <a href="index.html">home/alberts/deps/src/code.google.com/p/goprotobuf/proto</a> - lib.go<span style="font-size: 80%;"> (source / <a href="lib.go.func.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">go.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">193</td>
            <td class="headerCovTableEntry">314</td>
            <td class="headerCovTableEntryLo">61.5 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2012-03-12</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">19</td>
            <td class="headerCovTableEntry">29</td>
            <td class="headerCovTableEntryLo">65.5 %</td>
          </tr>
          <tr>
            <td></td>
            <td></td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">196</td>
            <td class="headerCovTableEntry">589</td>
            <td class="headerCovTableEntryLo">33.3 %</td>
          </tr>
          <tr><td><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : // Go support for Protocol Buffers - Google's data interchange format</a>
<span class="lineNum">       2 </span>                :            : //
<span class="lineNum">       3 </span>                :            : // Copyright 2010 Google Inc.  All rights reserved.
<span class="lineNum">       4 </span>                :            : // http://code.google.com/p/goprotobuf/
<span class="lineNum">       5 </span>                :            : //
<span class="lineNum">       6 </span>                :            : // Redistribution and use in source and binary forms, with or without
<span class="lineNum">       7 </span>                :            : // modification, are permitted provided that the following conditions are
<span class="lineNum">       8 </span>                :            : // met:
<span class="lineNum">       9 </span>                :            : //
<span class="lineNum">      10 </span>                :            : //     * Redistributions of source code must retain the above copyright
<span class="lineNum">      11 </span>                :            : // notice, this list of conditions and the following disclaimer.
<span class="lineNum">      12 </span>                :            : //     * Redistributions in binary form must reproduce the above
<span class="lineNum">      13 </span>                :            : // copyright notice, this list of conditions and the following disclaimer
<span class="lineNum">      14 </span>                :            : // in the documentation and/or other materials provided with the
<span class="lineNum">      15 </span>                :            : // distribution.
<span class="lineNum">      16 </span>                :            : //     * Neither the name of Google Inc. nor the names of its
<span class="lineNum">      17 </span>                :            : // contributors may be used to endorse or promote products derived from
<span class="lineNum">      18 </span>                :            : // this software without specific prior written permission.
<span class="lineNum">      19 </span>                :            : //
<span class="lineNum">      20 </span>                :            : // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
<span class="lineNum">      21 </span>                :            : // &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
<span class="lineNum">      22 </span>                :            : // LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
<span class="lineNum">      23 </span>                :            : // A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
<span class="lineNum">      24 </span>                :            : // OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
<span class="lineNum">      25 </span>                :            : // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
<span class="lineNum">      26 </span>                :            : // LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
<span class="lineNum">      27 </span>                :            : // DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
<span class="lineNum">      28 </span>                :            : // THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
<span class="lineNum">      29 </span>                :            : // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
<span class="lineNum">      30 </span>                :            : // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
<span class="lineNum">      31 </span>                :            : 
<span class="lineNum">      32 </span>                :            : /*
<span class="lineNum">      33 </span>                :            :         The proto package converts data structures to and from the
<span class="lineNum">      34 </span>                :            :         wire format of protocol buffers.  It works in concert with the
<span class="lineNum">      35 </span>                :            :         Go source code generated for .proto files by the protocol compiler.
<span class="lineNum">      36 </span>                :            : 
<span class="lineNum">      37 </span>                :            :         A summary of the properties of the protocol buffer interface
<span class="lineNum">      38 </span>                :            :         for a protocol buffer variable v:
<span class="lineNum">      39 </span>                :            : 
<span class="lineNum">      40 </span>                :            :           - Names are turned from camel_case to CamelCase for export.
<span class="lineNum">      41 </span>                :            :           - There are no methods on v to set and get fields; just treat
<span class="lineNum">      42 </span>                :            :                 them as structure fields.
<span class="lineNum">      43 </span>                :            :           - The zero value for a struct is its correct initialization state.
<span class="lineNum">      44 </span>                :            :                 All desired fields must be set before marshaling.
<span class="lineNum">      45 </span>                :            :           - A Reset() method will restore a protobuf struct to its zero state.
<span class="lineNum">      46 </span>                :            :           - Non-repeated fields are pointers to the values; nil means unset.
<span class="lineNum">      47 </span>                :            :                 That is, optional or required field int32 f becomes F *int32.
<span class="lineNum">      48 </span>                :            :           - Repeated fields are slices.
<span class="lineNum">      49 </span>                :            :           - Helper functions are available to simplify the getting and setting of fields:
<span class="lineNum">      50 </span>                :            :                 foo.String = proto.String(&quot;hello&quot;) // set field
<span class="lineNum">      51 </span>                :            :                 s := proto.GetString(foo.String)  // get field
<span class="lineNum">      52 </span>                :            :           - Constants are defined to hold the default values of all fields that
<span class="lineNum">      53 </span>                :            :                 have them.  They have the form Default_StructName_FieldName.
<span class="lineNum">      54 </span>                :            :           - Enums are given type names and maps between names to values,
<span class="lineNum">      55 </span>                :            :                 plus a helper function to create values.  Enum values are prefixed
<span class="lineNum">      56 </span>                :            :                 with the enum's type name. Enum types have a String method.
<span class="lineNum">      57 </span>                :            :           - Nested groups and enums have type names prefixed with the name of
<span class="lineNum">      58 </span>                :            :                 the surrounding message type.
<span class="lineNum">      59 </span>                :            :           - Extensions are given descriptor names that start with E_,
<span class="lineNum">      60 </span>                :            :                 followed by an underscore-delimited list of the nested messages
<span class="lineNum">      61 </span>                :            :                 that contain it (if any) followed by the CamelCased name of the
<span class="lineNum">      62 </span>                :            :                 extension field itself.  HasExtension, ClearExtension, GetExtension
<span class="lineNum">      63 </span>                :            :                 and SetExtension are functions for manipulating extensions.
<span class="lineNum">      64 </span>                :            :           - Marshal and Unmarshal are functions to encode and decode the wire format.
<span class="lineNum">      65 </span>                :            : 
<span class="lineNum">      66 </span>                :            :         The simplest way to describe this is to see an example.
<span class="lineNum">      67 </span>                :            :         Given file test.proto, containing
<span class="lineNum">      68 </span>                :            : 
<span class="lineNum">      69 </span>                :            :                 package example;
<span class="lineNum">      70 </span>                :            : 
<span class="lineNum">      71 </span>                :            :                 enum FOO { X = 17; };
<span class="lineNum">      72 </span>                :            : 
<span class="lineNum">      73 </span>                :            :                 message Test {
<span class="lineNum">      74 </span>                :            :                   required string label = 1;
<span class="lineNum">      75 </span>                :            :                   optional int32 type = 2 [default=77];
<span class="lineNum">      76 </span>                :            :                   repeated int64 reps = 3;
<span class="lineNum">      77 </span>                :            :                   optional group OptionalGroup = 4 {
<span class="lineNum">      78 </span>                :            :                     required string RequiredField = 5;
<span class="lineNum">      79 </span>                :            :                   };
<span class="lineNum">      80 </span>                :            :                 }
<span class="lineNum">      81 </span>                :            : 
<span class="lineNum">      82 </span>                :            :         The resulting file, test.pb.go, is:
<span class="lineNum">      83 </span>                :            : 
<span class="lineNum">      84 </span>                :            :                 package example
<span class="lineNum">      85 </span>                :            : 
<span class="lineNum">      86 </span>                :            :                 import &quot;code.google.com/p/goprotobuf/proto&quot;
<span class="lineNum">      87 </span>                :            : 
<span class="lineNum">      88 </span>                :            :                 type FOO int32
<span class="lineNum">      89 </span>                :            :                 const (
<span class="lineNum">      90 </span>                :            :                         FOO_X = 17
<span class="lineNum">      91 </span>                :            :                 )
<span class="lineNum">      92 </span>                :            :                 var FOO_name = map[int32] string {
<span class="lineNum">      93 </span>                :            :                         17: &quot;X&quot;,
<span class="lineNum">      94 </span>                :            :                 }
<span class="lineNum">      95 </span>                :            :                 var FOO_value = map[string] int32 {
<span class="lineNum">      96 </span>                :            :                         &quot;X&quot;: 17,
<span class="lineNum">      97 </span>                :            :                 }
<span class="lineNum">      98 </span>                :            :                 func NewFOO(x int32) *FOO {
<span class="lineNum">      99 </span>                :            :                         e := FOO(x)
<span class="lineNum">     100 </span>                :            :                         return &amp;e
<span class="lineNum">     101 </span>                :            :                 }
<span class="lineNum">     102 </span>                :            :                 func (x FOO) String() string {
<span class="lineNum">     103 </span>                :            :                         return proto.EnumName(FOO_name, int32(x))
<span class="lineNum">     104 </span>                :            :                 }
<span class="lineNum">     105 </span>                :            : 
<span class="lineNum">     106 </span>                :            :                 type Test struct {
<span class="lineNum">     107 </span>                :            :                         Label   *string `protobuf:&quot;bytes,1,req,name=label&quot;`
<span class="lineNum">     108 </span>                :            :                         Type    *int32  `protobuf:&quot;varint,2,opt,name=type,def=77&quot;`
<span class="lineNum">     109 </span>                :            :                         Reps    []int64 `protobuf:&quot;varint,3,rep,name=reps&quot;`
<span class="lineNum">     110 </span>                :            :                         Optionalgroup   *Test_OptionalGroup     `protobuf:&quot;group,4,opt,name=optionalgroup&quot;`
<span class="lineNum">     111 </span>                :            :                         XXX_unrecognized []byte
<span class="lineNum">     112 </span>                :            :                 }
<span class="lineNum">     113 </span>                :            :                 func (this *Test) Reset() {
<span class="lineNum">     114 </span>                :            :                         *this = Test{}
<span class="lineNum">     115 </span>                :            :                 }
<span class="lineNum">     116 </span>                :            :                 const Default_Test_Type int32 = 77
<span class="lineNum">     117 </span>                :            : 
<span class="lineNum">     118 </span>                :            :                 type Test_OptionalGroup struct {
<span class="lineNum">     119 </span>                :            :                         RequiredField   *string `protobuf:&quot;bytes,5,req&quot;`
<span class="lineNum">     120 </span>                :            :                         XXX_unrecognized []byte
<span class="lineNum">     121 </span>                :            :                 }
<span class="lineNum">     122 </span>                :            :                 func (this *Test_OptionalGroup) Reset() {
<span class="lineNum">     123 </span>                :            :                         *this = Test_OptionalGroup{}
<span class="lineNum">     124 </span>                :            :                 }
<span class="lineNum">     125 </span>                :            : 
<span class="lineNum">     126 </span>                :            :                 func init() {
<span class="lineNum">     127 </span>                :            :                         proto.RegisterEnum(&quot;example.FOO&quot;, FOO_name, FOO_value)
<span class="lineNum">     128 </span>                :            :                 }
<span class="lineNum">     129 </span>                :            : 
<span class="lineNum">     130 </span>                :            :         To create and play with a Test object:
<span class="lineNum">     131 </span>                :            : 
<span class="lineNum">     132 </span>                :            :                 package main
<span class="lineNum">     133 </span>                :            : 
<span class="lineNum">     134 </span>                :            :                 import (
<span class="lineNum">     135 </span>                :            :                         &quot;log&quot;
<span class="lineNum">     136 </span>                :            : 
<span class="lineNum">     137 </span>                :            :                         &quot;code.google.com/p/goprotobuf/proto&quot;
<span class="lineNum">     138 </span>                :            :                         &quot;./example.pb&quot;
<span class="lineNum">     139 </span>                :            :                 )
<span class="lineNum">     140 </span>                :            : 
<span class="lineNum">     141 </span>                :            :                 func main() {
<span class="lineNum">     142 </span>                :            :                         test := &amp;example.Test{
<span class="lineNum">     143 </span>                :            :                                 Label: proto.String(&quot;hello&quot;),
<span class="lineNum">     144 </span>                :            :                                 Type: proto.Int32(17),
<span class="lineNum">     145 </span>                :            :                                 Optionalgroup: &amp;example.Test_OptionalGroup{
<span class="lineNum">     146 </span>                :            :                                         RequiredField: proto.String(&quot;good bye&quot;),
<span class="lineNum">     147 </span>                :            :                                 },
<span class="lineNum">     148 </span>                :            :                         }
<span class="lineNum">     149 </span>                :            :                         data, err := proto.Marshal(test)
<span class="lineNum">     150 </span>                :            :                         if err != nil {
<span class="lineNum">     151 </span>                :            :                                 log.Fatal(&quot;marshaling error: &quot;, err)
<span class="lineNum">     152 </span>                :            :                         }
<span class="lineNum">     153 </span>                :            :                         newTest := new(example.Test)
<span class="lineNum">     154 </span>                :            :                         err = proto.Unmarshal(data, newTest)
<span class="lineNum">     155 </span>                :            :                         if err != nil {
<span class="lineNum">     156 </span>                :            :                                 log.Fatal(&quot;unmarshaling error: &quot;, err)
<span class="lineNum">     157 </span>                :            :                         }
<span class="lineNum">     158 </span>                :            :                         // Now test and newTest contain the same data.
<span class="lineNum">     159 </span>                :            :                         if proto.GetString(test.Label) != proto.GetString(newTest.Label) {
<span class="lineNum">     160 </span>                :            :                                 log.Fatalf(&quot;data mismatch %q != %q&quot;, proto.GetString(test.Label), proto.GetString(newTest.Label))
<span class="lineNum">     161 </span>                :            :                         }
<span class="lineNum">     162 </span>                :            :                         // etc.
<span class="lineNum">     163 </span>                :            :                 }
<span class="lineNum">     164 </span>                :            : */
<span class="lineNum">     165 </span>                :            : package proto
<span class="lineNum">     166 </span>                :            : 
<span class="lineNum">     167 </span>                :            : import (
<span class="lineNum">     168 </span>                :            :         &quot;fmt&quot;
<span class="lineNum">     169 </span>                :            :         &quot;log&quot;
<span class="lineNum">     170 </span>                :            :         &quot;reflect&quot;
<span class="lineNum">     171 </span>                :            :         &quot;strconv&quot;
<span class="lineNum">     172 </span>                :            :         &quot;sync&quot;
<span class="lineNum">     173 </span>                :            : )
<span class="lineNum">     174 </span>                :            : 
<span class="lineNum">     175 </span>                :            : // Stats records allocation details about the protocol buffer encoders
<span class="lineNum">     176 </span>                :            : // and decoders.  Useful for tuning the library itself.
<span class="lineNum">     177 </span>                :            : type Stats struct {
<span class="lineNum">     178 </span>                :            :         Emalloc uint64 // mallocs in encode
<span class="lineNum">     179 </span>                :            :         Dmalloc uint64 // mallocs in decode
<span class="lineNum">     180 </span>                :            :         Encode  uint64 // number of encodes
<span class="lineNum">     181 </span>                :            :         Decode  uint64 // number of decodes
<span class="lineNum">     182 </span>                :            :         Chit    uint64 // number of cache hits
<span class="lineNum">     183 </span>                :            :         Cmiss   uint64 // number of cache misses
<span class="lineNum">     184 </span>                :            : }
<span class="lineNum">     185 </span>                :            : 
<span class="lineNum">     186 </span>                :            : var stats Stats
<a name="187"><span class="lineNum">     187 </span>                :            : </a>
<span class="lineNum">     188 </span>                :            : // GetStats returns a copy of the global Stats structure.
<span class="lineNum">     189 </span>                :<span class="lineNoCov">          0 : func GetStats() Stats { return stats }</span>
<span class="lineNum">     190 </span>                :            : 
<span class="lineNum">     191 </span>                :            : // A Buffer is a buffer manager for marshaling and unmarshaling
<span class="lineNum">     192 </span>                :            : // protocol buffers.  It may be reused between invocations to
<span class="lineNum">     193 </span>                :            : // reduce memory usage.  It is not necessary to use a Buffer;
<span class="lineNum">     194 </span>                :            : // the global functions Marshal and Unmarshal create a
<span class="lineNum">     195 </span>                :            : // temporary Buffer and are fine for most applications.
<span class="lineNum">     196 </span>                :            : type Buffer struct {
<span class="lineNum">     197 </span>                :            :         buf       []byte     // encode/decode byte stream
<span class="lineNum">     198 </span>                :            :         index     int        // write point
<span class="lineNum">     199 </span>                :            :         freelist  [10][]byte // list of available buffers
<span class="lineNum">     200 </span>                :            :         nfreelist int        // number of free buffers
<span class="lineNum">     201 </span>                :            :         ptr       uintptr    // used to avoid a heap allocation.
<span class="lineNum">     202 </span>                :            :         // pools of basic types to amortize allocation.
<span class="lineNum">     203 </span>                :            :         bools  []bool
<span class="lineNum">     204 </span>                :            :         int32s []int32
<span class="lineNum">     205 </span>                :            :         int64s []int64
<span class="lineNum">     206 </span>                :            : }
<span class="lineNum">     207 </span>                :            : 
<a name="208"><span class="lineNum">     208 </span>                :            : // NewBuffer allocates a new Buffer and initializes its internal data to</a>
<span class="lineNum">     209 </span>                :            : // the contents of the argument slice.
<span class="lineNum">     210 </span>                :<span class="lineCov">       1053 : func NewBuffer(e []byte) *Buffer {</span>
<span class="lineNum">     211 </span>                :<span class="lineCov">       1053 :         p := new(Buffer)</span>
<span class="lineNum">     212 </span>        [<span class="branchCov" title="Branch 0 was taken 36 times"> + </span><span class="branchCov" title="Branch 1 was taken 1017 times"> + </span>]:<span class="lineCov">       1053 :         if e == nil {</span>
<span class="lineNum">     213 </span>                :<span class="lineCov">         36 :                 e = p.bufalloc()</span>
<span class="lineNum">     214 </span>                :            :         }
<span class="lineNum">     215 </span>                :<span class="lineCov">       1053 :         p.buf = e</span>
<span class="lineNum">     216 </span>                :<span class="lineCov">       1053 :         p.index = 0</span>
<span class="lineNum">     217 </span>                :<span class="lineCov">       1053 :         return p</span>
<span class="lineNum">     218 </span>                :            : }
<a name="219"><span class="lineNum">     219 </span>                :            : </a>
<span class="lineNum">     220 </span>                :            : // Reset resets the Buffer, ready for marshaling a new protocol buffer.
<span class="lineNum">     221 </span>                :<span class="lineCov">      45069 : func (p *Buffer) Reset() {</span>
<span class="lineNum">     222 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 45069 times"> + </span>]:<span class="lineCov">      45069 :         if p.buf == nil {</span>
<span class="lineNum">     223 </span>                :<span class="lineNoCov">          0 :                 p.buf = p.bufalloc()</span>
<span class="lineNum">     224 </span>                :            :         }
<span class="lineNum">     225 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 45069 times"> + </span>]:<span class="lineCov">      45069 :         p.buf = p.buf[0:0] // for reading/writing</span>
<span class="lineNum">     226 </span>                :<span class="lineCov">      45069 :         p.index = 0        // for reading</span>
<span class="lineNum">     227 </span>                :<span class="lineCov">      45069 : }</span>
<span class="lineNum">     228 </span>                :            : 
<a name="229"><span class="lineNum">     229 </span>                :            : // SetBuf replaces the internal buffer with the slice,</a>
<span class="lineNum">     230 </span>                :            : // ready for unmarshaling the contents of the slice.
<span class="lineNum">     231 </span>                :<span class="lineCov">          1 : func (p *Buffer) SetBuf(s []byte) {</span>
<span class="lineNum">     232 </span>                :<span class="lineCov">          1 :         p.buf = s</span>
<span class="lineNum">     233 </span>                :<span class="lineCov">          1 :         p.index = 0</span>
<span class="lineNum">     234 </span>                :<span class="lineCov">          1 : }</span>
<a name="235"><span class="lineNum">     235 </span>                :            : </a>
<span class="lineNum">     236 </span>                :            : // Bytes returns the contents of the Buffer.
<span class="lineNum">     237 </span>        [<span class="branchCov" title="Branch 0 was taken 12 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">         12 : func (p *Buffer) Bytes() []byte { return p.buf }</span>
<a name="238"><span class="lineNum">     238 </span>                :            : </a>
<span class="lineNum">     239 </span>                :            : // Allocate a buffer for the Buffer.
<span class="lineNum">     240 </span>                :<span class="lineCov">        209 : func (p *Buffer) bufalloc() []byte {</span>
<span class="lineNum">     241 </span>[<span class="branchCov" title="Branch 0 was taken 209 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 68 times"> + </span><span class="branchCov" title="Branch 3 was taken 141 times"> + </span>]:<span class="lineCov">        209 :         if p.nfreelist &gt; 0 {</span>
<span class="lineNum">     242 </span>                :            :                 // reuse an old one
<span class="lineNum">     243 </span>[<span class="branchCov" title="Branch 0 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         68 :                 p.nfreelist--</span>
<span class="lineNum">     244 </span>[<span class="branchCov" title="Branch 0 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchNoCov" title="Branch 2 was not taken"> - </span><span class="branchCov" title="Branch 3 was taken 68 times"> + </span>]:<span class="lineCov">         68 :                 s := p.freelist[p.nfreelist]</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 68 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     245 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 68 times"> + </span>]:<span class="lineCov">         68 :                 return s[0:0]</span>
<span class="lineNum">     246 </span>                :            :         }
<span class="lineNum">     247 </span>                :            :         // make a new one
<span class="lineNum">     248 </span>        [<span class="branchCov" title="Branch 0 was taken 141 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">        141 :         s := make([]byte, 0, 16)</span>
<span class="lineNum">     249 </span>                :<span class="lineCov">        209 :         return s</span>
<span class="lineNum">     250 </span>                :            : }
<a name="251"><span class="lineNum">     251 </span>                :            : </a>
<span class="lineNum">     252 </span>                :            : // Free (and remember in freelist) a byte buffer for the Buffer.
<span class="lineNum">     253 </span>                :<span class="lineCov">         73 : func (p *Buffer) buffree(s []byte) {</span>
<span class="lineNum">     254 </span>        [<span class="branchCov" title="Branch 0 was taken 73 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">         73 :         if p.nfreelist &lt; len(p.freelist) {</span>
<span class="lineNum">     255 </span>                :            :                 // Take next slot.
<span class="lineNum">     256 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 73 times"> + </span>]:<span class="lineCov">         73 :                 p.freelist[p.nfreelist] = s</span>
<span class="lineNum">     257 </span>                :<span class="lineCov">         73 :                 p.nfreelist++</span>
<span class="lineNum">     258 </span>                :<span class="lineCov">         73 :                 return</span>
<span class="lineNum">     259 </span>                :            :         }
<span class="lineNum">     260 </span>                :            : 
<span class="lineNum">     261 </span>                :            :         // Find the smallest.
<span class="lineNum">     262 </span>                :<span class="lineNoCov">          0 :         besti := -1</span>
<span class="lineNum">     263 </span>                :<span class="lineNoCov">          0 :         bestl := len(s)</span>
<span class="lineNum">     264 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :         for i, b := range p.freelist {</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>][<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     265 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 if len(b) &lt; bestl {</span>
<span class="lineNum">     266 </span>                :<span class="lineNoCov">          0 :                         besti = i</span>
<span class="lineNum">     267 </span>                :<span class="lineNoCov">          0 :                         bestl = len(b)</span>
<span class="lineNum">     268 </span>                :            :                 }
<span class="lineNum">     269 </span>                :            :         }
<span class="lineNum">     270 </span>                :            : 
<span class="lineNum">     271 </span>                :            :         // Overwrite the smallest.
<span class="lineNum">     272 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if besti &gt;= 0 {</span>
<span class="lineNum">     273 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 p.freelist[besti] = s</span>
<span class="lineNum">     274 </span>                :            :         }
<span class="lineNum">     275 </span>                :            : }
<span class="lineNum">     276 </span>                :            : 
<span class="lineNum">     277 </span>                :            : /*
<span class="lineNum">     278 </span>                :            :  * Helper routines for simplifying the creation of optional fields of basic type.
<span class="lineNum">     279 </span>                :            :  */
<span class="lineNum">     280 </span>                :            : 
<a name="281"><span class="lineNum">     281 </span>                :            : // Bool is a helper routine that allocates a new bool value</a>
<span class="lineNum">     282 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     283 </span>                :<span class="lineCov">         25 : func Bool(v bool) *bool {</span>
<span class="lineNum">     284 </span>                :<span class="lineCov">         25 :         p := new(bool)</span>
<span class="lineNum">     285 </span>                :<span class="lineCov">         25 :         *p = v</span>
<span class="lineNum">     286 </span>                :<span class="lineCov">         25 :         return p</span>
<span class="lineNum">     287 </span>                :            : }
<span class="lineNum">     288 </span>                :            : 
<a name="289"><span class="lineNum">     289 </span>                :            : // Int32 is a helper routine that allocates a new int32 value</a>
<span class="lineNum">     290 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     291 </span>                :<span class="lineCov">         80 : func Int32(v int32) *int32 {</span>
<span class="lineNum">     292 </span>                :<span class="lineCov">         80 :         p := new(int32)</span>
<span class="lineNum">     293 </span>                :<span class="lineCov">         80 :         *p = v</span>
<span class="lineNum">     294 </span>                :<span class="lineCov">         80 :         return p</span>
<span class="lineNum">     295 </span>                :            : }
<span class="lineNum">     296 </span>                :            : 
<span class="lineNum">     297 </span>                :            : // Int is a helper routine that allocates a new int32 value
<a name="298"><span class="lineNum">     298 </span>                :            : // to store v and returns a pointer to it, but unlike Int32</a>
<span class="lineNum">     299 </span>                :            : // its argument value is an int.
<span class="lineNum">     300 </span>                :<span class="lineNoCov">          0 : func Int(v int) *int32 {</span>
<span class="lineNum">     301 </span>                :<span class="lineNoCov">          0 :         p := new(int32)</span>
<span class="lineNum">     302 </span>                :<span class="lineNoCov">          0 :         *p = int32(v)</span>
<span class="lineNum">     303 </span>                :<span class="lineNoCov">          0 :         return p</span>
<span class="lineNum">     304 </span>                :            : }
<span class="lineNum">     305 </span>                :            : 
<a name="306"><span class="lineNum">     306 </span>                :            : // Int64 is a helper routine that allocates a new int64 value</a>
<span class="lineNum">     307 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     308 </span>                :<span class="lineCov">         47 : func Int64(v int64) *int64 {</span>
<span class="lineNum">     309 </span>                :<span class="lineCov">         47 :         p := new(int64)</span>
<span class="lineNum">     310 </span>                :<span class="lineCov">         47 :         *p = v</span>
<span class="lineNum">     311 </span>                :<span class="lineCov">         47 :         return p</span>
<span class="lineNum">     312 </span>                :            : }
<span class="lineNum">     313 </span>                :            : 
<a name="314"><span class="lineNum">     314 </span>                :            : // Float32 is a helper routine that allocates a new float32 value</a>
<span class="lineNum">     315 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     316 </span>                :<span class="lineCov">         27 : func Float32(v float32) *float32 {</span>
<span class="lineNum">     317 </span>                :<span class="lineCov">         27 :         p := new(float32)</span>
<span class="lineNum">     318 </span>                :<span class="lineCov">         27 :         *p = v</span>
<span class="lineNum">     319 </span>                :<span class="lineCov">         27 :         return p</span>
<span class="lineNum">     320 </span>                :            : }
<span class="lineNum">     321 </span>                :            : 
<a name="322"><span class="lineNum">     322 </span>                :            : // Float64 is a helper routine that allocates a new float64 value</a>
<span class="lineNum">     323 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     324 </span>                :<span class="lineCov">         21 : func Float64(v float64) *float64 {</span>
<span class="lineNum">     325 </span>                :<span class="lineCov">         21 :         p := new(float64)</span>
<span class="lineNum">     326 </span>                :<span class="lineCov">         21 :         *p = v</span>
<span class="lineNum">     327 </span>                :<span class="lineCov">         21 :         return p</span>
<span class="lineNum">     328 </span>                :            : }
<span class="lineNum">     329 </span>                :            : 
<a name="330"><span class="lineNum">     330 </span>                :            : // Uint32 is a helper routine that allocates a new uint32 value</a>
<span class="lineNum">     331 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     332 </span>                :<span class="lineCov">         43 : func Uint32(v uint32) *uint32 {</span>
<span class="lineNum">     333 </span>                :<span class="lineCov">         43 :         p := new(uint32)</span>
<span class="lineNum">     334 </span>                :<span class="lineCov">         43 :         *p = v</span>
<span class="lineNum">     335 </span>                :<span class="lineCov">         43 :         return p</span>
<span class="lineNum">     336 </span>                :            : }
<span class="lineNum">     337 </span>                :            : 
<a name="338"><span class="lineNum">     338 </span>                :            : // Uint64 is a helper routine that allocates a new uint64 value</a>
<span class="lineNum">     339 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     340 </span>                :<span class="lineCov">         42 : func Uint64(v uint64) *uint64 {</span>
<span class="lineNum">     341 </span>                :<span class="lineCov">         42 :         p := new(uint64)</span>
<span class="lineNum">     342 </span>                :<span class="lineCov">         42 :         *p = v</span>
<span class="lineNum">     343 </span>                :<span class="lineCov">         42 :         return p</span>
<span class="lineNum">     344 </span>                :            : }
<span class="lineNum">     345 </span>                :            : 
<a name="346"><span class="lineNum">     346 </span>                :            : // String is a helper routine that allocates a new string value</a>
<span class="lineNum">     347 </span>                :            : // to store v and returns a pointer to it.
<span class="lineNum">     348 </span>                :<span class="lineCov">        117 : func String(v string) *string {</span>
<span class="lineNum">     349 </span>                :<span class="lineCov">        117 :         p := new(string)</span>
<span class="lineNum">     350 </span>                :<span class="lineCov">        117 :         *p = v</span>
<span class="lineNum">     351 </span>                :<span class="lineCov">        117 :         return p</span>
<span class="lineNum">     352 </span>                :            : }
<span class="lineNum">     353 </span>                :            : 
<span class="lineNum">     354 </span>                :            : /*
<span class="lineNum">     355 </span>                :            :  * Helper routines for simplifying the fetching of optional fields of basic type.
<span class="lineNum">     356 </span>                :            :  * If the field is missing, they return the zero for the type.
<span class="lineNum">     357 </span>                :            :  */
<a name="358"><span class="lineNum">     358 </span>                :            : </a>
<span class="lineNum">     359 </span>                :            : // GetBool is a helper routine that returns an optional bool value.
<span class="lineNum">     360 </span>                :<span class="lineNoCov">          0 : func GetBool(p *bool) bool {</span>
<span class="lineNum">     361 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     362 </span>                :<span class="lineNoCov">          0 :                 return false</span>
<span class="lineNum">     363 </span>                :            :         }
<span class="lineNum">     364 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     365 </span>                :            : }
<a name="366"><span class="lineNum">     366 </span>                :            : </a>
<span class="lineNum">     367 </span>                :            : // GetInt32 is a helper routine that returns an optional int32 value.
<span class="lineNum">     368 </span>                :<span class="lineCov">          1 : func GetInt32(p *int32) int32 {</span>
<span class="lineNum">     369 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :         if p == nil {</span>
<span class="lineNum">     370 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     371 </span>                :            :         }
<span class="lineNum">     372 </span>                :<span class="lineCov">          1 :         return *p</span>
<span class="lineNum">     373 </span>                :            : }
<a name="374"><span class="lineNum">     374 </span>                :            : </a>
<span class="lineNum">     375 </span>                :            : // GetInt64 is a helper routine that returns an optional int64 value.
<span class="lineNum">     376 </span>                :<span class="lineNoCov">          0 : func GetInt64(p *int64) int64 {</span>
<span class="lineNum">     377 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     378 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     379 </span>                :            :         }
<span class="lineNum">     380 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     381 </span>                :            : }
<a name="382"><span class="lineNum">     382 </span>                :            : </a>
<span class="lineNum">     383 </span>                :            : // GetFloat32 is a helper routine that returns an optional float32 value.
<span class="lineNum">     384 </span>                :<span class="lineNoCov">          0 : func GetFloat32(p *float32) float32 {</span>
<span class="lineNum">     385 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     386 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     387 </span>                :            :         }
<span class="lineNum">     388 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     389 </span>                :            : }
<a name="390"><span class="lineNum">     390 </span>                :            : </a>
<span class="lineNum">     391 </span>                :            : // GetFloat64 is a helper routine that returns an optional float64 value.
<span class="lineNum">     392 </span>                :<span class="lineNoCov">          0 : func GetFloat64(p *float64) float64 {</span>
<span class="lineNum">     393 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     394 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     395 </span>                :            :         }
<span class="lineNum">     396 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     397 </span>                :            : }
<a name="398"><span class="lineNum">     398 </span>                :            : </a>
<span class="lineNum">     399 </span>                :            : // GetUint32 is a helper routine that returns an optional uint32 value.
<span class="lineNum">     400 </span>                :<span class="lineNoCov">          0 : func GetUint32(p *uint32) uint32 {</span>
<span class="lineNum">     401 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     402 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     403 </span>                :            :         }
<span class="lineNum">     404 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     405 </span>                :            : }
<a name="406"><span class="lineNum">     406 </span>                :            : </a>
<span class="lineNum">     407 </span>                :            : // GetUint64 is a helper routine that returns an optional uint64 value.
<span class="lineNum">     408 </span>                :<span class="lineNoCov">          0 : func GetUint64(p *uint64) uint64 {</span>
<span class="lineNum">     409 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if p == nil {</span>
<span class="lineNum">     410 </span>                :<span class="lineNoCov">          0 :                 return 0</span>
<span class="lineNum">     411 </span>                :            :         }
<span class="lineNum">     412 </span>                :<span class="lineNoCov">          0 :         return *p</span>
<span class="lineNum">     413 </span>                :            : }
<a name="414"><span class="lineNum">     414 </span>                :            : </a>
<span class="lineNum">     415 </span>                :            : // GetString is a helper routine that returns an optional string value.
<span class="lineNum">     416 </span>                :<span class="lineCov">          1 : func GetString(p *string) string {</span>
<span class="lineNum">     417 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :         if p == nil {</span>
<span class="lineNum">     418 </span>                :<span class="lineNoCov">          0 :                 return &quot;&quot;</span>
<span class="lineNum">     419 </span>                :            :         }
<span class="lineNum">     420 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :         return *p</span>
<span class="lineNum">     421 </span>                :            : }
<span class="lineNum">     422 </span>                :            : 
<a name="423"><span class="lineNum">     423 </span>                :            : // EnumName is a helper function to simplify printing protocol buffer enums</a>
<span class="lineNum">     424 </span>                :            : // by name.  Given an enum map and a value, it returns a useful string.
<span class="lineNum">     425 </span>                :<span class="lineNoCov">          0 : func EnumName(m map[int32]string, v int32) string {</span>
<span class="lineNum">     426 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         s, ok := m[v]</span>
<span class="lineNum">     427 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if ok {</span>
<span class="lineNum">     428 </span>                :<span class="lineNoCov">          0 :                 return s</span>
<span class="lineNum">     429 </span>                :            :         }
<span class="lineNum">     430 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         return &quot;unknown_enum_&quot; + strconv.Itoa(int(v))</span>
<span class="lineNum">     431 </span>                :            : }
<span class="lineNum">     432 </span>                :            : 
<a name="433"><span class="lineNum">     433 </span>                :            : // DebugPrint dumps the encoded data in b in a debugging format with a header</a>
<span class="lineNum">     434 </span>                :            : // including the string s. Used in testing but made available for general debugging.
<span class="lineNum">     435 </span>                :<span class="lineNoCov">          0 : func (o *Buffer) DebugPrint(s string, b []byte) {</span>
<span class="lineNum">     436 </span>                :<span class="lineNoCov">          0 :         var u uint64</span>
<span class="lineNum">     437 </span>                :            : 
<span class="lineNum">     438 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         obuf := o.buf</span>
<span class="lineNum">     439 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         index := o.index</span>
<span class="lineNum">     440 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         o.buf = b</span>
<span class="lineNum">     441 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         o.index = 0</span>
<span class="lineNum">     442 </span>                :<span class="lineNoCov">          0 :         depth := 0</span>
<span class="lineNum">     443 </span>                :            : 
<span class="lineNum">     444 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :         fmt.Printf(&quot;\n--- %s ---\n&quot;, s)</span>
<span class="lineNum">     445 </span>                :            : 
<span class="lineNum">     446 </span>                :            : out:
<span class="lineNum">     447 </span>                :            :         for {
<span class="lineNum">     448 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 for i := 0; i &lt; depth; i++ {</span>
<span class="lineNum">     449 </span>        [<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Print(&quot;  &quot;)</span>
<span class="lineNum">     450 </span>                :            :                 }
<span class="lineNum">     451 </span>                :            : 
<span class="lineNum">     452 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 index := o.index</span>
<span class="lineNum">     453 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 if index == len(o.buf) {</span>
<span class="lineNum">     454 </span>                :            :                         break
<span class="lineNum">     455 </span>                :            :                 }
<span class="lineNum">     456 </span>                :            : 
<span class="lineNum">     457 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 op, err := o.DecodeVarint()</span>
<span class="lineNum">     458 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 if err != nil {</span>
<span class="lineNum">     459 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: fetching op err %v\n&quot;, index, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>]
<span class="lineNum">     460 </span>                :            :                         break out
<span class="lineNum">     461 </span>                :            :                 }
<span class="lineNum">     462 </span>                :<span class="lineNoCov">          0 :                 tag := op &gt;&gt; 3</span>
<span class="lineNum">     463 </span>                :<span class="lineNoCov">          0 :                 wire := op &amp; 7</span>
<span class="lineNum">     464 </span>                :            : 
<span class="lineNum">     465 </span>  [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span> :<span class="lineNoCov">          0 :                 switch wire {</span>
<span class="lineNum">         </span>      <span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]
<span class="lineNum">     466 </span>                :            :                 default:
<span class="lineNum">     467 </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d unknown wire=%d\n&quot;,</span>
<span class="lineNum">     468 </span>                :            :                                 index, tag, wire)
<span class="lineNum">     469 </span>                :            :                         break out
<span class="lineNum">     470 </span>                :            : 
<span class="lineNum">     471 </span>                :<span class="lineNoCov">          0 :                 case WireBytes:</span>
<span class="lineNum">     472 </span>                :<span class="lineNoCov">          0 :                         var r []byte</span>
<span class="lineNum">     473 </span>                :            : 
<span class="lineNum">     474 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         r, err = o.DecodeRawBytes(false)</span>
<span class="lineNum">     475 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     476 </span>                :            :                                 break out
<span class="lineNum">     477 </span>                :            :                         }
<span class="lineNum">     478 </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d bytes [%d]&quot;, index, tag, len(r))</span>
<span class="lineNum">     479 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if len(r) &lt;= 6 {</span>
<span class="lineNum">     480 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 for i := 0; i &lt; len(r); i++ {</span>
<span class="lineNum">     481 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                         fmt.Printf(&quot; %.2x&quot;, r[i])</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     482 </span>                :            :                                 }
<span class="lineNum">     483 </span>                :            :                         } else {
<span class="lineNum">     484 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 for i := 0; i &lt; 3; i++ {</span>
<span class="lineNum">     485 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                         fmt.Printf(&quot; %.2x&quot;, r[i])</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     486 </span>                :            :                                 }
<span class="lineNum">     487 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot; ..&quot;)</span>
<span class="lineNum">     488 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 for i := len(r) - 3; i &lt; len(r); i++ {</span>
<span class="lineNum">     489 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                         fmt.Printf(&quot; %.2x&quot;, r[i])</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     490 </span>                :            :                                 }
<span class="lineNum">     491 </span>                :            :                         }
<span class="lineNum">     492 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;\n&quot;)</span>
<span class="lineNum">     493 </span>                :            : 
<span class="lineNum">     494 </span>                :<span class="lineNoCov">          0 :                 case WireFixed32:</span>
<span class="lineNum">     495 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         u, err = o.DecodeFixed32()</span>
<span class="lineNum">     496 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     497 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot;%3d: t=%3d fix32 err %v\n&quot;, index, tag, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     498 </span>                :            :                                 break out
<span class="lineNum">     499 </span>                :            :                         }
<span class="lineNum">     500 </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d fix32 %d\n&quot;, index, tag, u)</span>
<span class="lineNum">     501 </span>                :            : 
<span class="lineNum">     502 </span>                :            :                 case WireFixed64:
<span class="lineNum">     503 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         u, err = o.DecodeFixed64()</span>
<span class="lineNum">     504 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     505 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot;%3d: t=%3d fix64 err %v\n&quot;, index, tag, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     506 </span>                :            :                                 break out
<span class="lineNum">     507 </span>                :            :                         }
<span class="lineNum">     508 </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d fix64 %d\n&quot;, index, tag, u)</span>
<span class="lineNum">     509 </span>                :<span class="lineNoCov">          0 :                         break</span>
<span class="lineNum">     510 </span>                :            : 
<span class="lineNum">     511 </span>                :<span class="lineNoCov">          0 :                 case WireVarint:</span>
<span class="lineNum">     512 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         u, err = o.DecodeVarint()</span>
<span class="lineNum">     513 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     514 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot;%3d: t=%3d varint err %v\n&quot;, index, tag, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     515 </span>                :            :                                 break out
<span class="lineNum">     516 </span>                :            :                         }
<span class="lineNum">     517 </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d varint %d\n&quot;, index, tag, u)</span>
<span class="lineNum">     518 </span>                :            : 
<span class="lineNum">     519 </span>                :<span class="lineNoCov">          0 :                 case WireStartGroup:</span>
<span class="lineNum">     520 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     521 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot;%3d: t=%3d start err %v\n&quot;, index, tag, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     522 </span>                :            :                                 break out
<span class="lineNum">     523 </span>                :            :                         }
<span class="lineNum">     524 </span>        [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d start\n&quot;, index, tag)</span>
<span class="lineNum">     525 </span>                :<span class="lineNoCov">          0 :                         depth++</span>
<span class="lineNum">     526 </span>                :            : 
<span class="lineNum">     527 </span>                :<span class="lineNoCov">          0 :                 case WireEndGroup:</span>
<span class="lineNum">     528 </span>                :<span class="lineNoCov">          0 :                         depth--</span>
<span class="lineNum">     529 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         if err != nil {</span>
<span class="lineNum">     530 </span>[<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 fmt.Printf(&quot;%3d: t=%3d end err %v\n&quot;, index, tag, err)</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">     531 </span>                :            :                                 break out
<span class="lineNum">     532 </span>                :            :                         }
<span class="lineNum">     533 </span>        [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         fmt.Printf(&quot;%3d: t=%3d end\n&quot;, index, tag)</span>
<span class="lineNum">     534 </span>                :            :                 }
<span class="lineNum">     535 </span>                :<span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     536 </span>                :            : 
<span class="lineNum">     537 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         if depth != 0 {</span>
<span class="lineNum">     538 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>]:<span class="lineNoCov">          0 :                 fmt.Printf(&quot;%3d: start-end not balanced %d\n&quot;, o.index, depth)</span>
<span class="lineNum">     539 </span>                :            :         }
<span class="lineNum">     540 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         fmt.Printf(&quot;\n&quot;)</span>
<span class="lineNum">     541 </span>                :            : 
<span class="lineNum">     542 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         o.buf = obuf</span>
<span class="lineNum">     543 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :         o.index = index</span>
<span class="lineNum">     544 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     545 </span>                :            : 
<span class="lineNum">     546 </span>                :            : // SetDefaults sets unset protocol buffer fields to their default values.
<a name="547"><span class="lineNum">     547 </span>                :            : // It only modifies fields that are both unset and have defined defaults.</a>
<span class="lineNum">     548 </span>                :            : // It recursively sets default values in any non-nil sub-messages.
<span class="lineNum">     549 </span>                :<span class="lineCov">          3 : func SetDefaults(pb interface{}) {</span>
<span class="lineNum">     550 </span>                :<span class="lineCov">          3 :         v := reflect.ValueOf(pb)</span>
<span class="lineNum">     551 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span>]:<span class="lineCov">          3 :         if v.Kind() != reflect.Ptr || v.Elem().Kind() != reflect.Struct {</span>
<span class="lineNum">     552 </span>                :<span class="lineNoCov">          0 :                 log.Printf(&quot;proto: hit non-pointer-to-struct %v&quot;, v)</span>
<span class="lineNum">     553 </span>                :            :         }
<span class="lineNum">     554 </span>                :<span class="lineCov">          3 :         setDefaults(v, true, false)</span>
<span class="lineNum">     555 </span>                :<span class="lineCov">          3 : }</span>
<a name="556"><span class="lineNum">     556 </span>                :            : </a>
<span class="lineNum">     557 </span>                :            : // v is a pointer to a struct.
<span class="lineNum">     558 </span>                :<span class="lineCov">          4 : func setDefaults(v reflect.Value, recur, zeros bool) {</span>
<span class="lineNum">     559 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :         v = v.Elem()</span>
<span class="lineNum">     560 </span>                :            : 
<span class="lineNum">     561 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :         defaultMu.RLock()</span>
<span class="lineNum">     562 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :         dm, ok := defaults[v.Type()]</span>
<span class="lineNum">     563 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :         defaultMu.RUnlock()</span>
<span class="lineNum">     564 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          4 :         if !ok {</span>
<span class="lineNum">     565 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          3 :                 dm = buildDefaultMessage(v.Type())</span>
<span class="lineNum">     566 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :                 defaultMu.Lock()</span>
<span class="lineNum">     567 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          3 :                 defaults[v.Type()] = dm</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 6 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 7 was not taken"> - </span>]
<span class="lineNum">     568 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :                 defaultMu.Unlock()</span>
<span class="lineNum">     569 </span>                :            :         }
<span class="lineNum">     570 </span>                :            : 
<span class="lineNum">     571 </span>[<span class="branchCov" title="Branch 1 was taken 44 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 44 times"> + </span><span class="branchCov" title="Branch 4 was taken 4 times"> + </span>]:<span class="lineCov">         48 :         for _, sf := range dm.scalars {</span>
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 44 times"> + </span>]
<span class="lineNum">     572 </span>        [<span class="branchCov" title="Branch 1 was taken 44 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">         44 :                 f := v.Field(sf.index)</span>
<span class="lineNum">     573 </span>[<span class="branchCov" title="Branch 0 was taken 44 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 36 times"> + </span><span class="branchCov" title="Branch 4 was taken 8 times"> + </span>]:<span class="lineCov">         44 :                 if !f.IsNil() {</span>
<span class="lineNum">     574 </span>                :            :                         // field already set
<span class="lineNum">     575 </span>                :            :                         continue
<span class="lineNum">     576 </span>                :            :                 }
<span class="lineNum">     577 </span>                :<span class="lineCov">         36 :                 dv := sf.value</span>
<span class="lineNum">     578 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchCov" title="Branch 1 was taken 33 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 33 times"> + </span><span class="branchCov" title="Branch 3 was taken 3 times"> + </span>]:<span class="lineCov">         36 :                 if dv == nil &amp;&amp; !zeros {</span>
<span class="lineNum">     579 </span>                :            :                         // no explicit default, and don't want to set zeros
<span class="lineNum">     580 </span>                :            :                         continue
<span class="lineNum">     581 </span>                :            :                 }
<span class="lineNum">     582 </span>[<span class="branchCov" title="Branch 0 was taken 33 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 33 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         33 :                 fptr := f.Addr().Interface() // **T</span>
<span class="lineNum">     583 </span>                :            :                 // TODO: Consider batching the allocations we do here.
<span class="lineNum">     584 </span>  [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchCov" title="Branch 1 was taken 7 times"> + </span><span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchCov" title="Branch 3 was taken 6 times"> + </span> :<span class="lineCov">         33 :                 switch sf.kind {</span>
<span class="lineNum">         </span><span class="branchCov" title="Branch 4 was taken 4 times"> + </span><span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchCov" title="Branch 7 was taken 4 times"> + </span><span class="branchCov" title="Branch 8 was taken 4 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<span class="lineNum">     585 </span>                :<span class="lineCov">          2 :                 case reflect.Bool:</span>
<span class="lineNum">     586 </span>                :<span class="lineCov">          2 :                         b := new(bool)</span>
<span class="lineNum">     587 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         if dv != nil {</span>
<span class="lineNum">     588 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                                 *b = dv.(bool)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     589 </span>                :            :                         }
<span class="lineNum">     590 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                         *(fptr.(**bool)) = b</span>
<span class="lineNum">     591 </span>                :<span class="lineCov">          7 :                 case reflect.Float32:</span>
<span class="lineNum">     592 </span>                :<span class="lineCov">          7 :                         f := new(float32)</span>
<span class="lineNum">     593 </span>        [<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          7 :                         if dv != nil {</span>
<span class="lineNum">     594 </span>[<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          7 :                                 *f = dv.(float32)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     595 </span>                :            :                         }
<span class="lineNum">     596 </span>[<span class="branchCov" title="Branch 0 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 7 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          7 :                         *(fptr.(**float32)) = f</span>
<span class="lineNum">     597 </span>                :<span class="lineCov">          2 :                 case reflect.Float64:</span>
<span class="lineNum">     598 </span>                :<span class="lineCov">          2 :                         f := new(float64)</span>
<span class="lineNum">     599 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         if dv != nil {</span>
<span class="lineNum">     600 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                                 *f = dv.(float64)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     601 </span>                :            :                         }
<span class="lineNum">     602 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                         *(fptr.(**float64)) = f</span>
<span class="lineNum">     603 </span>                :<span class="lineCov">          6 :                 case reflect.Int32:</span>
<span class="lineNum">     604 </span>                :            :                         // might be an enum
<span class="lineNum">     605 </span>[<span class="branchCov" title="Branch 0 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 6 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          6 :                         if ft := f.Type(); ft != int32PtrType {</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 6 was taken 2 times"> + </span><span class="branchCov" title="Branch 7 was taken 4 times"> + </span>]
<span class="lineNum">     606 </span>                :            :                                 // enum
<span class="lineNum">     607 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">          2 :                                 f.Set(reflect.New(ft.Elem()))</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>][<span class="branchCov" title="Branch 7 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 12 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 15 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 16 was not taken"> - </span>]
<span class="lineNum">     608 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                                 if dv != nil {</span>
<span class="lineNum">     609 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                                         f.Elem().SetInt(int64(dv.(int32)))</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>][<span class="branchCov" title="Branch 8 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 9 was not taken"> - </span>]
<span class="lineNum">     610 </span>                :            :                                 }
<span class="lineNum">     611 </span>                :            :                         } else {
<span class="lineNum">     612 </span>                :            :                                 // int32 field
<span class="lineNum">     613 </span>                :<span class="lineCov">          4 :                                 i := new(int32)</span>
<span class="lineNum">     614 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                                 if dv != nil {</span>
<span class="lineNum">     615 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                                         *i = dv.(int32)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     616 </span>                :            :                                 }
<span class="lineNum">     617 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                                 *(fptr.(**int32)) = i</span>
<span class="lineNum">     618 </span>                :            :                         }
<span class="lineNum">     619 </span>                :<span class="lineCov">          4 :                 case reflect.Int64:</span>
<span class="lineNum">     620 </span>                :<span class="lineCov">          4 :                         i := new(int64)</span>
<span class="lineNum">     621 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                         if dv != nil {</span>
<span class="lineNum">     622 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                                 *i = dv.(int64)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     623 </span>                :            :                         }
<span class="lineNum">     624 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                         *(fptr.(**int64)) = i</span>
<span class="lineNum">     625 </span>                :<span class="lineCov">          2 :                 case reflect.String:</span>
<span class="lineNum">     626 </span>                :<span class="lineCov">          2 :                         s := new(string)</span>
<span class="lineNum">     627 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         if dv != nil {</span>
<span class="lineNum">     628 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                                 *s = dv.(string)</span>
<span class="lineNum">     629 </span>                :            :                         }
<span class="lineNum">     630 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                         *(fptr.(**string)) = s</span>
<span class="lineNum">     631 </span>                :<span class="lineCov">          2 :                 case reflect.Uint8:</span>
<span class="lineNum">     632 </span>                :            :                         // exceptional case: []byte
<span class="lineNum">     633 </span>                :<span class="lineCov">          2 :                         var b []byte</span>
<span class="lineNum">     634 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         if dv != nil {</span>
<span class="lineNum">     635 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                                 db := dv.([]byte)</span>
<span class="lineNum">     636 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                                 b = make([]byte, len(db))</span>
<span class="lineNum">     637 </span>                :<span class="lineCov">          2 :                                 copy(b, db)</span>
<span class="lineNum">     638 </span>                :            :                         } else {
<span class="lineNum">     639 </span>                :<span class="lineNoCov">          0 :                                 b = []byte{}</span>
<span class="lineNum">     640 </span>                :            :                         }
<span class="lineNum">     641 </span>[<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          2 :                         *(fptr.(*[]byte)) = b</span>
<span class="lineNum">     642 </span>                :<span class="lineCov">          4 :                 case reflect.Uint32:</span>
<span class="lineNum">     643 </span>                :<span class="lineCov">          4 :                         u := new(uint32)</span>
<span class="lineNum">     644 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                         if dv != nil {</span>
<span class="lineNum">     645 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                                 *u = dv.(uint32)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     646 </span>                :            :                         }
<span class="lineNum">     647 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                         *(fptr.(**uint32)) = u</span>
<span class="lineNum">     648 </span>                :<span class="lineCov">          4 :                 case reflect.Uint64:</span>
<span class="lineNum">     649 </span>                :<span class="lineCov">          4 :                         u := new(uint64)</span>
<span class="lineNum">     650 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                         if dv != nil {</span>
<span class="lineNum">     651 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                                 *u = dv.(uint64)</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 5 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>]
<span class="lineNum">     652 </span>                :            :                         }
<span class="lineNum">     653 </span>[<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">          4 :                         *(fptr.(**uint64)) = u</span>
<span class="lineNum">     654 </span>                :<span class="lineCov">         44 :                 default:</span>
<span class="lineNum">     655 </span>        [<span class="branchNoExec" title="Branch 3 was not executed"> # </span><span class="branchNoExec" title="Branch 4 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         log.Printf(&quot;proto: can't set default for field %v (sf.kind=%v)&quot;, f, sf.kind)</span>
<span class="lineNum">     656 </span>                :            :                 }
<span class="lineNum">     657 </span>                :            :         }
<span class="lineNum">     658 </span>                :            : 
<span class="lineNum">     659 </span>[<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 3 times"> + </span><span class="branchCov" title="Branch 4 was taken 4 times"> + </span>]:<span class="lineCov">          7 :         for _, ni := range dm.nested {</span>
<span class="lineNum">         </span>        [<span class="branchNoCov" title="Branch 5 was not taken"> - </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span>]
<span class="lineNum">     660 </span>        [<span class="branchCov" title="Branch 1 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          3 :                 f := v.Field(ni)</span>
<span class="lineNum">     661 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 2 times"> + </span><span class="branchCov" title="Branch 4 was taken 1 time"> + </span>]:<span class="lineCov">          3 :                 if f.IsNil() {</span>
<span class="lineNum">     662 </span>                :<span class="lineCov">          2 :                         continue</span>
<span class="lineNum">     663 </span>                :            :                 }
<span class="lineNum">     664 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                 setDefaults(f, recur, zeros)</span>
<span class="lineNum">     665 </span>                :            :         }
<span class="lineNum">     666 </span>                :<span class="lineCov">          4 : }</span>
<span class="lineNum">     667 </span>                :            : 
<span class="lineNum">     668 </span>                :            : var (
<span class="lineNum">     669 </span>                :            :         // defaults maps a protocol buffer struct type to a slice of the fields,
<span class="lineNum">     670 </span>                :            :         // with its scalar fields set to their proto-declared non-zero default values.
<span class="lineNum">     671 </span>                :            :         defaultMu sync.RWMutex
<span class="lineNum">     672 </span>                :            :         defaults  = make(map[reflect.Type]defaultMessage)
<span class="lineNum">     673 </span>                :            : 
<span class="lineNum">     674 </span>                :            :         int32PtrType = reflect.TypeOf((*int32)(nil))
<span class="lineNum">     675 </span>                :            : )
<span class="lineNum">     676 </span>                :            : 
<span class="lineNum">     677 </span>                :            : // defaultMessage represents information about the default values of a message.
<span class="lineNum">     678 </span>                :            : type defaultMessage struct {
<span class="lineNum">     679 </span>                :            :         scalars []scalarField
<span class="lineNum">     680 </span>                :            :         nested  []int // struct field index of nested messages
<span class="lineNum">     681 </span>                :            : }
<span class="lineNum">     682 </span>                :            : 
<span class="lineNum">     683 </span>                :            : type scalarField struct {
<span class="lineNum">     684 </span>                :            :         index int          // struct field index
<span class="lineNum">     685 </span>                :            :         kind  reflect.Kind // element type (the T in *T or []T)
<span class="lineNum">     686 </span>                :            :         value interface{}  // the proto-declared default value, or nil
<span class="lineNum">     687 </span>                :            : }
<a name="688"><span class="lineNum">     688 </span>                :            : </a>
<span class="lineNum">     689 </span>                :            : // t is a struct type.
<span class="lineNum">     690 </span>                :<span class="lineCov">          3 : func buildDefaultMessage(t reflect.Type) (dm defaultMessage) {</span>
<span class="lineNum">     691 </span>        [<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          3 :         sprop := GetProperties(t)</span>
<span class="lineNum">     692 </span>[<span class="branchCov" title="Branch 0 was taken 3 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 3 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 4 was not taken"> - </span>]:<span class="lineCov">         31 :         for _, prop := range sprop.Prop {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 28 times"> + </span><span class="branchCov" title="Branch 6 was taken 3 times"> + </span>][<span class="branchNoCov" title="Branch 7 was not taken"> - </span><span class="branchCov" title="Branch 8 was taken 28 times"> + </span>]
<span class="lineNum">     693 </span>[<span class="branchCov" title="Branch 0 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         28 :                 fi := sprop.tags[prop.Tag]</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 4 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 5 was not taken"> - </span>][<span class="branchCov" title="Branch 7 was taken 25 times"> + </span><span class="branchCov" title="Branch 8 was taken 3 times"> + </span>]
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 9 was taken 25 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>]
<span class="lineNum">     694 </span>[<span class="branchCov" title="Branch 0 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         28 :                 ft := t.Field(fi).Type</span>
<span class="lineNum">     695 </span>                :            : 
<span class="lineNum">     696 </span>                :            :                 // nested messages
<span class="lineNum">     697 </span>[<span class="branchCov" title="Branch 0 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 28 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         28 :                 if ft.Kind() == reflect.Ptr &amp;&amp; ft.Elem().Kind() == reflect.Struct {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 26 times"> + </span><span class="branchCov" title="Branch 6 was taken 2 times"> + </span>][<span class="branchCov" title="Branch 7 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 9 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 10 was not taken"> - </span>][<span class="branchCov" title="Branch 12 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 13 was not taken"> - </span>]
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 14 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 15 was not taken"> - </span>][<span class="branchCov" title="Branch 17 was taken 2 times"> + </span><span class="branchCov" title="Branch 18 was taken 26 times"> + </span>]
<span class="lineNum">     698 </span>                :<span class="lineCov">          2 :                         dm.nested = append(dm.nested, fi)</span>
<span class="lineNum">     699 </span>                :            :                         continue
<span class="lineNum">     700 </span>                :            :                 }
<span class="lineNum">     701 </span>                :            : 
<span class="lineNum">     702 </span>                :<span class="lineCov">         26 :                 sf := scalarField{</span>
<span class="lineNum">     703 </span>                :            :                         index: fi,
<span class="lineNum">     704 </span>[<span class="branchCov" title="Branch 0 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         26 :                         kind:  ft.Elem().Kind(),</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>][<span class="branchCov" title="Branch 7 was taken 26 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">     705 </span>                :            :                 }
<span class="lineNum">     706 </span>                :            : 
<span class="lineNum">     707 </span>                :            :                 // scalar fields without defaults
<span class="lineNum">     708 </span>        [<span class="branchCov" title="Branch 1 was taken 8 times"> + </span><span class="branchCov" title="Branch 2 was taken 18 times"> + </span>]:<span class="lineCov">         26 :                 if prop.Default == &quot;&quot; {</span>
<span class="lineNum">     709 </span>                :<span class="lineCov">          8 :                         dm.scalars = append(dm.scalars, sf)</span>
<span class="lineNum">     710 </span>                :            :                         continue
<span class="lineNum">     711 </span>                :            :                 }
<span class="lineNum">     712 </span>                :            : 
<span class="lineNum">     713 </span>                :            :                 // a scalar field: either *T or []byte
<span class="lineNum">     714 </span>[<span class="branchCov" title="Branch 0 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>][<span class="branchCov" title="Branch 2 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">         18 :                 switch ft.Elem().Kind() {</span>
<span class="lineNum">         </span>[<span class="branchCov" title="Branch 5 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 6 was not taken"> - </span>][<span class="branchCov" title="Branch 7 was taken 18 times"> + </span><span class="branchNoCov" title="Branch 8 was not taken"> - </span>]
<span class="lineNum">         </span>  [<span class="branchCov" title="Branch 10 was taken 1 time"> + </span><span class="branchCov" title="Branch 11 was taken 4 times"> + </span><span class="branchCov" title="Branch 12 was taken 1 time"> + </span><span class="branchCov" title="Branch 13 was taken 4 times"> + </span> 
<span class="lineNum">         </span><span class="branchCov" title="Branch 14 was taken 2 times"> + </span><span class="branchCov" title="Branch 15 was taken 1 time"> + </span><span class="branchCov" title="Branch 16 was taken 1 time"> + </span><span class="branchCov" title="Branch 17 was taken 2 times"> + </span><span class="branchCov" title="Branch 18 was taken 2 times"> + </span> 
<span class="lineNum">         </span>            <span class="branchNoCov" title="Branch 19 was not taken"> - </span>]
<span class="lineNum">     715 </span>                :<span class="lineCov">          1 :                 case reflect.Bool:</span>
<span class="lineNum">     716 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                         x, err := strconv.ParseBool(prop.Default)</span>
<span class="lineNum">     717 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :                         if err != nil {</span>
<span class="lineNum">     718 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default bool %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     719 </span>                :            :                                 continue
<span class="lineNum">     720 </span>                :            :                         }
<span class="lineNum">     721 </span>                :<span class="lineCov">          1 :                         sf.value = x</span>
<span class="lineNum">     722 </span>                :<span class="lineCov">          4 :                 case reflect.Float32:</span>
<span class="lineNum">     723 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                         x, err := strconv.ParseFloat(prop.Default, 32)</span>
<span class="lineNum">     724 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">          4 :                         if err != nil {</span>
<span class="lineNum">     725 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default float32 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     726 </span>                :            :                                 continue
<span class="lineNum">     727 </span>                :            :                         }
<span class="lineNum">     728 </span>        [<span class="branchCov" title="Branch 1 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          4 :                         sf.value = float32(x)</span>
<span class="lineNum">     729 </span>                :<span class="lineCov">          1 :                 case reflect.Float64:</span>
<span class="lineNum">     730 </span>        [<span class="branchCov" title="Branch 0 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          1 :                         x, err := strconv.ParseFloat(prop.Default, 64)</span>
<span class="lineNum">     731 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 1 time"> + </span>]:<span class="lineCov">          1 :                         if err != nil {</span>
<span class="lineNum">     732 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default float64 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     733 </span>                :            :                                 continue
<span class="lineNum">     734 </span>                :            :                         }
<span class="lineNum">     735 </span>                :<span class="lineCov">          1 :                         sf.value = x</span>
<span class="lineNum">     736 </span>                :<span class="lineCov">          4 :                 case reflect.Int32:</span>
<span class="lineNum">     737 </span>        [<span class="branchCov" title="Branch 0 was taken 4 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          4 :                         x, err := strconv.ParseInt(prop.Default, 10, 32)</span>
<span class="lineNum">     738 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 4 times"> + </span>]:<span class="lineCov">          4 :                         if err != nil {</span>
<span class="lineNum">     739 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default int32 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     740 </span>                :            :                                 continue
<span class="lineNum">     741 </span>                :            :                         }
<span class="lineNum">     742 </span>                :<span class="lineCov">          4 :                         sf.value = int32(x)</span>
<span class="lineNum">     743 </span>                :<span class="lineCov">          2 :                 case reflect.Int64:</span>
<span class="lineNum">     744 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         x, err := strconv.ParseInt(prop.Default, 10, 64)</span>
<span class="lineNum">     745 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          2 :                         if err != nil {</span>
<span class="lineNum">     746 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default int64 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     747 </span>                :            :                                 continue
<span class="lineNum">     748 </span>                :            :                         }
<span class="lineNum">     749 </span>                :<span class="lineCov">          2 :                         sf.value = x</span>
<span class="lineNum">     750 </span>                :<span class="lineCov">          1 :                 case reflect.String:</span>
<span class="lineNum">     751 </span>        [<span class="branchCov" title="Branch 1 was taken 1 time"> + </span><span class="branchNoCov" title="Branch 2 was not taken"> - </span>]:<span class="lineCov">          1 :                         sf.value = prop.Default</span>
<span class="lineNum">     752 </span>                :<span class="lineCov">          1 :                 case reflect.Uint8:</span>
<span class="lineNum">     753 </span>                :            :                         // []byte (not *uint8)
<span class="lineNum">     754 </span>                :<span class="lineCov">          1 :                         sf.value = []byte(prop.Default)</span>
<span class="lineNum">     755 </span>                :<span class="lineCov">          2 :                 case reflect.Uint32:</span>
<span class="lineNum">     756 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         x, err := strconv.ParseUint(prop.Default, 10, 32)</span>
<span class="lineNum">     757 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          2 :                         if err != nil {</span>
<span class="lineNum">     758 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default uint32 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     759 </span>                :            :                                 continue
<span class="lineNum">     760 </span>                :            :                         }
<span class="lineNum">     761 </span>                :<span class="lineCov">          2 :                         sf.value = uint32(x)</span>
<span class="lineNum">     762 </span>                :<span class="lineCov">          2 :                 case reflect.Uint64:</span>
<span class="lineNum">     763 </span>        [<span class="branchCov" title="Branch 0 was taken 2 times"> + </span><span class="branchNoCov" title="Branch 1 was not taken"> - </span>]:<span class="lineCov">          2 :                         x, err := strconv.ParseUint(prop.Default, 10, 64)</span>
<span class="lineNum">     764 </span>        [<span class="branchNoCov" title="Branch 0 was not taken"> - </span><span class="branchCov" title="Branch 1 was taken 2 times"> + </span>]:<span class="lineCov">          2 :                         if err != nil {</span>
<span class="lineNum">     765 </span>[<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>][<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]:<span class="lineNoCov">          0 :                                 log.Printf(&quot;proto: bad default uint64 %q: %v&quot;, prop.Default, err)</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 6 was not executed"> # </span><span class="branchNoExec" title="Branch 7 was not executed"> # </span>][<span class="branchNoExec" title="Branch 8 was not executed"> # </span><span class="branchNoExec" title="Branch 9 was not executed"> # </span>]
<span class="lineNum">     766 </span>                :            :                                 continue
<span class="lineNum">     767 </span>                :            :                         }
<span class="lineNum">     768 </span>                :<span class="lineCov">          2 :                         sf.value = x</span>
<span class="lineNum">     769 </span>                :            :                 default:
<span class="lineNum">     770 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :                         log.Printf(&quot;proto: unhandled def kind %v&quot;, ft.Elem().Kind())</span>
<span class="lineNum">         </span>[<span class="branchNoExec" title="Branch 5 was not executed"> # </span><span class="branchNoExec" title="Branch 6 was not executed"> # </span>][<span class="branchNoExec" title="Branch 7 was not executed"> # </span><span class="branchNoExec" title="Branch 8 was not executed"> # </span>]
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 12 was not executed"> # </span><span class="branchNoExec" title="Branch 13 was not executed"> # </span>]
<span class="lineNum">     771 </span>                :            :                         continue
<span class="lineNum">     772 </span>                :            :                 }
<span class="lineNum">     773 </span>                :            : 
<span class="lineNum">     774 </span>                :<span class="lineCov">         28 :                 dm.scalars = append(dm.scalars, sf)</span>
<span class="lineNum">     775 </span>                :            :         }
<span class="lineNum">     776 </span>                :            : 
<span class="lineNum">     777 </span>                :<span class="lineCov">          3 :         return dm</span>
<span class="lineNum">     778 </span>                :            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.9</a></td></tr>
  </table>
  <br>

</body>
</html>
